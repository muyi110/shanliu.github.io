<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/shanliu.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/shanliu.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/shanliu.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/shanliu.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/shanliu.github.io/css/main.css">


<link rel="stylesheet" href="/shanliu.github.io/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"muyi110.github.io","root":"/shanliu.github.io/","scheme":"Gemini","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="既已无岸，不必回头，唯有向前，踏碎云霄，放肆桀骜">
<meta property="og:type" content="website">
<meta property="og:title" content="山柳">
<meta property="og:url" content="https://muyi110.github.io/shanliu.github.io/index.html">
<meta property="og:site_name" content="山柳">
<meta property="og:description" content="既已无岸，不必回头，唯有向前，踏碎云霄，放肆桀骜">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="山柳">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://muyi110.github.io/shanliu.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>山柳</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/shanliu.github.io/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">山柳</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/shanliu.github.io/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/shanliu.github.io/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/shanliu.github.io/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/shanliu.github.io/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://muyi110.github.io/shanliu.github.io/2021/Centos7%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/shanliu.github.io/images/wukong.png">
      <meta itemprop="name" content="山柳">
      <meta itemprop="description" content="既已无岸，不必回头，唯有向前，踏碎云霄，放肆桀骜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山柳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/shanliu.github.io/2021/Centos7%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Centos7系统安装配置</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-13 15:28:06" itemprop="dateCreated datePublished" datetime="2021-03-13T15:28:06+08:00">2021-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-20 17:46:26" itemprop="dateModified" datetime="2021-03-20T17:46:26+08:00">2021-03-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/shanliu.github.io/categories/vim/" itemprop="url" rel="index"><span itemprop="name">vim</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>此博客记录电脑安装Centos7系统（无GUI）一些初始化配置</p>
</blockquote>
<h1 id="U盘制作Centos7系统启动盘"><a href="#U盘制作Centos7系统启动盘" class="headerlink" title="U盘制作Centos7系统启动盘"></a>U盘制作Centos7系统启动盘</h1><h2 id="Mac系统制作启动盘"><a href="#Mac系统制作启动盘" class="headerlink" title="Mac系统制作启动盘"></a>Mac系统制作启动盘</h2><ol>
<li><p>将U盘插入电脑，输入命令<code>diskutil list</code>查看相关挂载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> diskutil list</span></span><br><span class="line">/dev/disk0 (internal, physical):</span><br><span class="line"><span class="meta">   #</span><span class="bash">:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:      GUID_partition_scheme                        *500.3 GB   disk0</span><br><span class="line">   1:                        EFI EFI                     314.6 MB   disk0s1</span><br><span class="line">   2:                 Apple_APFS Container disk1         500.0 GB   disk0s2</span><br><span class="line"></span><br><span class="line">/dev/disk1 (synthesized):</span><br><span class="line"><span class="meta">   #</span><span class="bash">:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:      APFS Container Scheme -                      +500.0 GB   disk1</span><br><span class="line">                                 Physical Store disk0s2</span><br><span class="line">   1:                APFS Volume Macintosh HD            11.3 GB    disk1s1</span><br><span class="line">   2:                APFS Volume Macintosh HD - Data     87.0 GB    disk1s2</span><br><span class="line">   3:                APFS Volume Preboot                 81.9 MB    disk1s3</span><br><span class="line">   4:                APFS Volume Recovery                528.9 MB   disk1s4</span><br><span class="line">   5:                APFS Volume VM                      1.1 GB     disk1s5</span><br><span class="line"></span><br><span class="line">/dev/disk2 (external, physical):</span><br><span class="line"><span class="meta">   #</span><span class="bash">:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:     FDisk_partition_scheme                        *15.6 GB    disk2</span><br><span class="line">   1:                       0xEF                         9.0 MB     disk2s2</span><br></pre></td></tr></table></figure>

<p>其中<code>/dev/disk2</code>表示插入的U盘</p>
</li>
<li><p>不挂载U盘</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> diskutil unmountDisk /dev/disk2</span></span><br><span class="line">Unmount of all volumes on disk2 was successful</span><br></pre></td></tr></table></figure>
</li>
<li><p>开始制作启动盘</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo dd <span class="keyword">if</span>=CentOS-7-x86_64-Minimal-2009.iso of=/dev/disk2 bs=1m</span></span><br><span class="line">Password:</span><br><span class="line">973+0 records in</span><br><span class="line">973+0 records out</span><br><span class="line">1020264448 bytes transferred in 513.309363 secs (1987621 bytes/sec)</span><br></pre></td></tr></table></figure>

<p>此过程需要等待几分钟</p>
</li>
<li><p>安装系统</p>
</li>
</ol>
<h1 id="Centos7系统配置"><a href="#Centos7系统配置" class="headerlink" title="Centos7系统配置"></a>Centos7系统配置</h1><h2 id="配置有线网络"><a href="#配置有线网络" class="headerlink" title="配置有线网络"></a>配置有线网络</h2><ol>
<li><p>查看本机网卡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> nmcli d</span></span><br><span class="line">DEVICE  TYPE      STATE   CONNECTION</span><br><span class="line">p4p1    ethernet  已连接  p4p1</span><br><span class="line">wlp2s0  wifi      不可用  --</span><br><span class="line">lo      loopback  未托管  --</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入目录<code>/etc//sysconfig/network-scripts</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /etc/sysconfig/network-scripts/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls</span></span><br><span class="line">ifcfg-lo     ifdown-ippp  ifdown-routes    ifup          ifup-ipv6   ifup-ppp       ifup-tunnel</span><br><span class="line">ifcfg-p4p1   ifdown-ipv6  ifdown-sit       ifup-aliases  ifup-isdn   ifup-routes    ifup-wireless</span><br><span class="line">ifdown       ifdown-isdn  ifdown-Team      ifup-bnep     ifup-plip   ifup-sit       init.ipv6-global</span><br><span class="line">ifdown-bnep  ifdown-post  ifdown-TeamPort  ifup-eth      ifup-plusb  ifup-Team      network-functions</span><br><span class="line">ifdown-eth   ifdown-ppp   ifdown-tunnel    ifup-ippp     ifup-post   ifup-TeamPort  network-functions-ipv6</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开<code>ifcfg-p4p1</code>文件，修改如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# vi ifcfg-p4p1</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=dhcp   # 这里修改</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=p4p1</span><br><span class="line">UUID=6f2067d2-d31e-4b74-ad93-51e0ca294b01</span><br><span class="line">DEVICE=p4p1</span><br><span class="line">ONBOOT=yes      # 这里修改</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# systemctl restart network</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="配置无线网络（失败）"><a href="#配置无线网络（失败）" class="headerlink" title="配置无线网络（失败）"></a>配置无线网络（失败）</h2><ol>
<li><p>将刚刚安装系统的U盘在插回电脑</p>
</li>
<li><p>将U盘挂载到<code>/mnt/</code>目录，或者其他自定义目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# mount /dev/sdb /mnt/</span><br><span class="line">[root@192 ~]# ls /mnt/</span><br><span class="line">CentOS_BuildTag  EULA  images    LiveOS    repodata              RPM-GPG-KEY-CentOS-Testing-7</span><br><span class="line">EFI              GPL   isolinux  Packages  RPM-GPG-KEY-CentOS-7  TRANS.TBL</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看<code>Manager-wifi</code>全名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# ls /mnt/Packages/ | grep Manager-wifi</span><br><span class="line">NetworkManager-wifi-1.18.8-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装<code>NetworkManager-wifi-1.18.8-1.el7.x86_64.rpm</code>包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# rpm -ivh /mnt/Packages/NetworkManager-wifi-1.18.8-1.el7.x86_64.rpm</span><br><span class="line">准备中...                          ################################# [100%]</span><br><span class="line">	软件包 NetworkManager-wifi-1:1.18.8-1.el7.x86_64 已经安装</span><br></pre></td></tr></table></figure>

<p>同理安装<code>wpa_supplicant-xxx-xxx.x86_64.rpm</code></p>
</li>
<li><p>推出U盘</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# umount /mnt/</span><br><span class="line">[root@192 ~]# eject /dev/sdb</span><br><span class="line">[root@192 ~]# reboot</span><br></pre></td></tr></table></figure>
</li>
<li><p>连接<code>wifi</code>（没有成功）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# nmcli dev wifi</span><br><span class="line">IN-USE  SSID  MODE  CHAN  RATE  SIGNAL  BARS  SECURITY</span><br><span class="line">[root@192 ~]# nmcli dev wifi connect WIFI名称 password WIFI密码</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="配置无线网络"><a href="#配置无线网络" class="headerlink" title="配置无线网络"></a>配置无线网络</h2><ol>
<li><p>执行下面命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> nmcli d</span></span><br><span class="line">DEVICE  TYPE      STATE   CONNECTION</span><br><span class="line">p4p1    ethernet  已连接  p4p1</span><br><span class="line">wlp2s0  wifi      不可用  --</span><br><span class="line">lo      loopback  未托管  --</span><br><span class="line"><span class="meta">#</span><span class="bash"> ip link <span class="built_in">set</span> wlp2s0 up</span></span><br><span class="line">RTNETLINK answers: Operation not possible due to RF-kill</span><br></pre></td></tr></table></figure>
</li>
<li><p>按下<code>Fn+F2</code>继续执行<code>ip link set wlp2s0 up</code>成功</p>
</li>
<li><p>连接<code>wifi</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> nmcli dev wifi connect wifi_name password wifi_password</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nmcli dev wifi <span class="comment"># 查看wifi信息</span></span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="控制台字体及颜色设置"><a href="#控制台字体及颜色设置" class="headerlink" title="控制台字体及颜色设置"></a>控制台字体及颜色设置</h2><ol>
<li>默认控制台字体太小，查看系统字体</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]$ ls /lib/kbd/consolefonts/</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>选择字体<code>sun12x22</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]$ echo "setfont sun12x22" &gt;&gt; /etc/profile</span><br><span class="line">[root@centos7 ~]$ source /etc/profile  # 生效</span><br></pre></td></tr></table></figure>
</li>
<li><p>控制台提示符设置颜色（青绿色）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]$ vi .bashrc   # 添加下面一行</span><br><span class="line">PS1="\[\e[36;40m\][\u@\h \W]\$ \[\e[0m\]"</span><br><span class="line">[root@centos7 ~]$ source .bashrc</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看终端颜色配置方案，并配置为<code>xterm</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/profile</span></span><br><span class="line">在最后添加  export TERM=xterm</span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /ets/profile</span></span><br></pre></td></tr></table></figure>


</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://muyi110.github.io/shanliu.github.io/2020/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/shanliu.github.io/images/wukong.png">
      <meta itemprop="name" content="山柳">
      <meta itemprop="description" content="既已无岸，不必回头，唯有向前，踏碎云霄，放肆桀骜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山柳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/shanliu.github.io/2020/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Kubernetes学习笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-29 22:53:33" itemprop="dateCreated datePublished" datetime="2020-11-29T22:53:33+08:00">2020-11-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-30 22:14:55" itemprop="dateModified" datetime="2021-01-30T22:14:55+08:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/shanliu.github.io/categories/kubernetes/" itemprop="url" rel="index"><span itemprop="name">kubernetes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>此博客主要关于 <em>Kubernetes in Action</em> 书籍过程中笔记</p>
</blockquote>
<h1 id="Kubernetes背景"><a href="#Kubernetes背景" class="headerlink" title="Kubernetes背景"></a>Kubernetes背景</h1><img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201129235556776.png" alt="image-20201129235556776" style="zoom:45%;" />

<h2 id="理解kubernetes的需求"><a href="#理解kubernetes的需求" class="headerlink" title="理解kubernetes的需求"></a>理解<em>kubernetes</em>的需求</h2><p>早期的单体应用缺点：</p>
<ol>
<li>牵一发而动全身（开发、发布、…)；</li>
<li>运行在少数可以提供计算能力的高性能服务器上；</li>
<li>系统扩容，垂直扩容（不需要改变程序）增加硬件资源，例如cpu，存储等，但有上限；水平扩容（需要改动代码，增加服务器运行服务的副本）困难；如果某个组件不能扩容，则整个服务不可扩容。</li>
</ol>
<p>基于上述问题，需要将单体服务拆为微服务，每个微服务作为独立的程序运行，互不影响，之间通过API通信，如下图所示。微服务通信通过同步同步协议，例如HTTP，或者异步协议，例如AMQP（Advanced Message Queueing Protocol）。每个微服务可以用不同的语言开发。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201130235722746.png" alt="image-20201130235722746" style="zoom:50%;" />

<p>微服务扩容是基于每个微服务的，也就是说可以只扩容需要扩容的微服务。有些服务可以水平扩容，有些可以垂直扩容，如下图所示。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201201002458204.png" alt="image-20201201002458204" style="zoom:40%;" />

<p>微服务存在缺点：</p>
<ol>
<li>微服务多的时候，开发和部署变得麻烦，因为需要了解各个服务之间的依赖关系，容易出错；</li>
<li>跟踪调试问题变得困难，因为不同的微服务可能在不同的服务器上。</li>
</ol>
<p>微服务开发和部署可以独立进行，也就是说不同的微服务可以由不同的团队负责，这样不同的微服务环境依赖存在差异是必然的，如下图所示。在相同的服务器上部署的微服务越多，将是越困难的去提供满足所有微服务的依赖环境。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201201003729919.png" alt="image-20201201003729919" style="zoom:50%;" />

<p>开发环境和生产环境的差异性（包括硬件，系统，软件库等），以及生产机器环境的变化是实际中需要处理的问题。解决方法是开发环境和生产环境一致，开发者部署服务，op管理硬件等资源。因此Kubernetes登场了，Kubernetes对实际硬件做抽象，然后将自身暴露成一个平台，用于部署和运行应用程序。它允许开发者自己 配置和部署应用程序，而不需要op的任何帮助 让op聚焦于保持 底层基础设施运转正常的同时，不需要关注实际运行在平台上的应用程序。</p>
<h2 id="容器技术"><a href="#容器技术" class="headerlink" title="容器技术"></a>容器技术</h2><p>Kubernetes使用Linux容器技术隔离应用程序。运行在容器里面的进程实际运行在宿主机的操作系统上（可以看成宿主机上的一个进程，和虚拟机VM不一样，VM里的进程是运行的独立的操作系统）。下图对比了VM和容器运行多个微服务，由于VM比较吃资源，一台机器不会有很多VM，所以需要将微服务分组，分别在VM里面运行；容器比较轻量，每一个容器可以用来跑一个微服务。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201203003150464.png" alt="image-20201203003150464" style="zoom:50%;" />

<p>运行在虚拟机里的应用程序会执行<code>Guest OS</code>的系统调用， 然后VM内核会通过管理程序在宿主机上的物理CPU执行x86指令。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201203004939261.png" alt="image-20201203004939261" style="zoom:40%;" />

<p>所有的容器在宿主机上的内核执行系统调用，CPU不需要做任何虚拟化（这点和VM不一样），下图显示了VM中的应用和容器中的应用使用CPU的差异。</p>
<p><img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201203004504984.png" alt="image-20201203004504984" style="zoom:35%;" /><img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201203004522048.png" alt="image-20201203004522048" style="zoom:35%;" /></p>
<p>总结容器和VM的差异如下：</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201203010959130.png" alt="image-20201203010959130" style="zoom:50%;" />

<p>容器实现隔离的机制：Linux namespaces和Linux control groups (croups)。</p>
<p>Linux namespaces: 使得每个进程只看到自己的系统视图（files, processes, network interfaces, hostname, and so on）；</p>
<p>Linux control groups: 限制进程消耗的资源（CPU，内存，网络带宽等等）；</p>
<p>Docker容器镜像是由层组成，每一层可以被共享或者重复利用。Docker主要有3个部分：</p>
<ol>
<li>镜像：包括应用程序和其依赖的环境，其他的元数据，例如可执行文件（镜像运行的时候会执行的）的路径；</li>
<li>仓库：存放Docker容器镜像，方便用来共享镜像；</li>
<li>容器：基于镜像的Linux容器，一个正在运行的容器是运行Docker宿主机上的一个进程（和其他进程完全隔离）。</li>
</ol>
<p>下图显示了构建，发布，运行Docker镜像的流程：</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201206160908559.png" alt="image-20201206160908559" style="zoom:50%;" />

<p>Docker容器和虚拟机的差异如下图所示：</p>
<p><img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201206161054003.png" alt="image-20201206161054003" style="zoom:50%;" /><img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201206161112691.png" alt="image-20201206161112691" style="zoom:47%;" /></p>
<p>图中可以看到，app A和app B可以访问相同的二进制文件和库，对于VM显而易见（因为都在同一个操作系统里面），但是容器都有其自己隔离的文件系统，为什么会这样呢？因为Docker镜像是由层组成，不同的镜像可以包含相同的层（底层），层的好处包含加速镜像发布效率，节约存储空间（每一层只会存储一份）。所以基于不同的镜像运行的Docker容器可以读相同的文件（这些相同的文件就是底层），但是一个容器写这些文件，另一个容器是不能看到修改后的变化的，因此容器之间是互相隔离的（This works because container image layers are read-only. When a container is run, a new writable layer is created on top of the layers in the image. When the process in the container writes to a file located in one of the underlying layers, a copy of the whole file is created in the top-most layer and the process writes to the copy）。</p>
<p>容器镜像的限制：运行在宿主机上的容器共享宿主机上的Linux内核，如果容器需要的内核版本和宿主机上的不同，容器可能不能正常工作，同时也会受到硬件架构的影响（比如x86和ARM），VM没有这种限制，因为VM有其自己独立的内核。</p>
<p>Docker本身并不能提供隔离，只是利用Linux namespaces和Linux control groups (croups)，Docker只是容器的一种，还有其他容器，后面只是针对Docke进行说明。</p>
<h2 id="Kubernetes介绍"><a href="#Kubernetes介绍" class="headerlink" title="Kubernetes介绍"></a>Kubernetes介绍</h2><p>当机器规模大了后，即使利用率小的改善也会带来可观的收益。早期谷歌内部开发了Borg和Omega系统，后来在2014年，基于早起的经验，谷歌开源了Kubernetes（一个软件系统，抽象硬件资源，使其容易发布管理基于容器的应用）。</p>
<p>下图显示了Kubernetes的简单视图，由一个master节点和众多worker节点组成。开发者提交软件清单到master节点，Kubernetes将其发布到worker节点的集群。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201206184201388.png" alt="image-20201206184201388" style="zoom:50%;" />

<p>节点是Kubernetes里的最小计算单元，可以理解为一台机器，是物理机或者虚拟机。</p>
<p>可以将Kubernetes看出集群的操作系统，Kubernetes提供一些基础服务包括：服务发现，扩容，负载均衡，自愈，甚至领导选举等。同时Kubernetes可以对应用重新分配，提高资源的利用率。</p>
<p>下面开始介绍Kubernetes集群的架构。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201206185714894.png" alt="image-20201206185714894" style="zoom:50%;" />

<p>在硬件层面，Kubernetes集群由许多节点组成，分为两类，master节点和worker节点。</p>
<ul>
<li>master节点：承载着控制和管理整个Kubernetes系统的<code>Kubernetes Control Plane</code></li>
<li>worker节点：运行部署的实际的应用</li>
</ul>
<p><code>The Control Plane</code>用来控制集群，使集群生效，其由多个组件组成，可以运行在一个单独的master节点上，或者通过副本运行在多个主节点上以确保高可靠性。这些组件包括如下：</p>
<ul>
<li>The <em>Kubernetes API Server</em>：你和其他的控制面板组件都需要通信的；</li>
<li>The <em>Scheduler</em>：调度apps，为应用的每一个部署微服务（或者说是组件）分配一个工作节点；</li>
<li>The <em>Controller Manager</em>：执行集群级别的功能，例如复制组件，持续跟踪工作节点，处理节点失败等等；</li>
<li>The etched：一个可靠的分布式数据存储，可以持久化存储集群配置；</li>
</ul>
<p>控制板的组件保持和控制集群的状态，他们并不运行任何应用程序，应用程序是通过工作节点来运行的。对应用程序提供运行，监控和服务的任务是由以下组件完成：</p>
<ul>
<li>Docker, rkt, or another <em>container runtime</em>, which runs your containers</li>
<li>The <em>Kubelet</em>：与API Server通信，管理所在节点的容器</li>
<li>The <em>Kubernetes Service Proxy (kube-proxy)</em>：负责组件之间的负载均衡网络流量</li>
</ul>
<p>在Kubernetes中运行一个应用。流程：将应用打包成一个或多个镜像–&gt;将镜像推倒镜像仓库–&gt;给Kubernetes API server推送一个描述文件。描述文件包括容器镜像信息，多少副本，哪些需要运行在同一个节点上等等。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201207000224833.png" alt="image-20201207000224833" style="zoom:50%;" />

<p>当API server处理应用的描述文件时，the Scheduler基于每组容器需要的计算资源以及工作节点非分配的资源调度指定组容器运行在可用的节点上。在节点上的Kubelet指示Container Runtime（例如Docker）拉取容器镜像并运行容器。</p>
<p><strong>保活</strong>：一旦应用运行起来，Kubernetes会持续确保部署的应用状态会满足描述文件里规定的。例如，如果在描述文件里面指定一个服务有5个副本运行，则Kubernetes总是确保有5个副本服务运行，一旦某个服务意外死掉了，则Kubernetes会自动重启服务。如果整个工作节点死掉或不可访问了，Kubernetes会在新的节点上运行在死掉节点上的所有容器。</p>
<p><strong>扩容</strong>：当应用在运行的时候，可以决定增加或者减少副本的数量。甚至可以让Kubernetes决定最优的副本数量，Kubernetes会基于实时指标，例如CPU负载，内存使用，每秒查询量等调整副本的数量。</p>
<p><strong>命中移动目标</strong>：当Kubernetes在集群里面迁移容器（例如运行容器的节点死掉，或者给其他容器挪空间而从一个节点摘除），如果容器给其他容器或者外部的客户端提供服务，如何正确使用正在迁移的容器呢？客户端如何连接到提供服务的容器（提供服务的容器被复制被分散到整个集群）？为了让客户端容易找到提供特定服务的容器，可以告诉Kubernetes哪些容器提供相同的服务，Kubernetes会通过一个静态的IP地址暴露所有的提供特定服务的容器，并将改地址暴露给集群里运行的应用。静态IP地址通过环境变量提供。The kube-proxy确保连接到提供特定服务的容器是负载均衡的。由于IP地址是固定的，因此客户端总是可以连接到，即使在容器在集群里迁移的时候。</p>
<p>使用Kubernetes的好处：</p>
<ul>
<li>简化应用部署</li>
<li>实现更好的硬件利用率</li>
<li>健康检查，自我修复</li>
<li>自动扩缩容</li>
<li>简化应用的开发</li>
</ul>
<h1 id="Docker和Kubernetes的第一步"><a href="#Docker和Kubernetes的第一步" class="headerlink" title="Docker和Kubernetes的第一步"></a>Docker和Kubernetes的第一步</h1><h2 id="创建，运行及共享容器镜像"><a href="#创建，运行及共享容器镜像" class="headerlink" title="创建，运行及共享容器镜像"></a>创建，运行及共享容器镜像</h2><p>在Kubernetes里面运行的容器镜像需要被打包成容器镜像。首先对Docker的使用做简单的介绍。</p>
<p>首先需要在Linux机器上安装Docker，如果不是Linux系统，需要安装Linux虚拟机运行Docker，如果是Mac或者Windows系统，Docker会自己启动一个虚拟机，并在其中运行Docker守护进程。Docker客户端可执行文件可以在宿主机系统上运行，并与在虚拟机中的Docker守护进程通信。</p>
<p><a href="http://docs.docker.com/engine/installation/" target="_blank" rel="noopener">安装官方地址</a>，完成安装后，使用Docker客户端完成各种Docker命令。 下面命令运行busybox镜像并打印 Hello world</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run busybox echo "Hello world"</span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Unable to find image 'busybox:latest' locally</span><br><span class="line">latest: Pulling from library/busybox</span><br><span class="line">ea97eb0eb3ec: Pull complete</span><br><span class="line">Digest: sha256:bde48e1751173b709090c2539fdf12d6ba64e88ec7a4301591227ce925f3c678</span><br><span class="line">Status: Downloaded newer image for busybox:latest</span><br><span class="line">Hello world</span><br></pre></td></tr></table></figure>

<p>下图显示了上述Docker run命令的执行流程</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201208012318453.png" alt="image-20201208012318453" style="zoom:50%;" />

<p>运行Docker镜像命令如下（最基本的，没有加参数或者命令）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run &lt;images&gt; 或者 sudo docker run &lt;image&gt;:&lt;tag&gt;</span><br></pre></td></tr></table></figure>

<p>将应用打包为一个镜像，首先需要创建一个Dockerfile文件，Dockerfile文件包含一系列Docker构建镜像时候会执行的指令。编译镜像的命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker build -t &lt;image_name&gt; .</span><br></pre></td></tr></table></figure>

<p>下图显示了上面docker build命令的执行流程</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201213230108106.png" alt="image-20201213230108106" style="zoom:50%;" />

<p>build命令告诉Docker基于当前目录里的内容构建一个<image_name>镜像，Docker会在当前目录查找Dockerfile文件，基于Dockerfile文件里面的命令构建镜像。注意，镜像的构建操作不是由Docker客户端完成，而是由守护进程完成，客户端会将整个目录上传到Docker守护进程中。Docker客户端和守护进程不需要运行在同一台机器上。</p>
<p>Docker镜像是由很多层组成，不同的镜像可以共享某些层。镜像中的每一层只会存储一份。构建镜像的过程中，基于Dockerfile文件里的每一行命令都会在最上面创建一个新的层，下图显示了构建镜像过程中层的关系</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20201213232658033.png" alt="image-20201213232658033" style="zoom:50%;" />

<p>列举本地所有的镜像命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo docker images 或者 sudo docker image ls</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">busybox             latest              219ee5171f80        9 days ago          1.23MB</span><br><span class="line">tomcat              latest              2703bbe9e9d4        4 weeks ago         648MB</span><br><span class="line">nginx               latest              c39a868aad02        5 weeks ago         133MB</span><br><span class="line">centos              latest              0d120b6ccaa8        4 months ago        215MB</span><br></pre></td></tr></table></figure>

<p>运行容器镜像也可以加一些参数，例如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --name kubia-container -p 8080:8080 -d kubia</span><br></pre></td></tr></table></figure>

<ul>
<li>–name: 指定新运行容器的名字</li>
<li>-d: 后台进程运行</li>
<li>-p: 端口映射（本机端口:容器端口）。可以通过本机地址8080端口访问，如果是在虚拟机中运行Docker守护进程，需要指定虚拟机的IP或者hostname</li>
</ul>
<p>下面的命令列举所有正在运行的容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps  # 只是显示最基本的信息</span><br><span class="line">sudo docker ps -a # 查看所有容器，包括运行的，没有运行的</span><br><span class="line">sudo docker ps -aq # 结果只是显示容器ID</span><br></pre></td></tr></table></figure>

<p>显示详细信息的命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker inspect &lt;container_name&gt;</span><br></pre></td></tr></table></figure>

<p>由于在一个容器里面可以运行多个进程，因此可以运行一个进程（例如shell，如果有的话）进入到一个正在运行的Docker容器里面。例如可以运行下面的命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec -it &lt;container_name&gt; /bin/bash # exit可以退出一个容器</span><br></pre></td></tr></table></figure>

<p>上述命令中的bash进程会有相同的Linux namespaces和主容器进程</p>
<ul>
<li>-i: 确保 STDIN 被打开</li>
<li>-t: 分配一个伪终端</li>
</ul>
<p>进入到一个正在运行的容器中后，运行下面的命令可以查看在容器里运行的进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps aux</span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root           1  8.5  2.4 4638036 96096 ?       Ssl  16:06   0:05 /usr/local/openjdk-11/bin/java -Djava.util.logging.config.file=</span><br><span class="line">root          45  0.1  0.0   5748  3592 pts/0    Ss   16:06   0:00 /bin/bash</span><br><span class="line">root          52  0.0  0.0   9388  3084 pts/0    R+   16:07   0:00 ps aux</span><br></pre></td></tr></table></figure>

<p>在宿主机上打开终端运行下面的命令，可以看到在容器里运行的进行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep openjdk-11</span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root        4542  2.6  2.4 4638036 96284 ?       Ssl  00:06   0:05 /usr/local/openjdk-11/bin/java -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 -Dignore.endorsed.dirs= -classpath /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar -Dcatalina.base=/usr/local/tomcat -Dcatalina.home=/usr/local/tomcat -Djava.io.tmpdir=/usr/local/tomcat/temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">yangliu+    4748  0.0  0.0  12128   660 pts/1    S+   00:09   0:00 grep --color=auto openjdk-11</span><br></pre></td></tr></table></figure>

<p>上面结果证明了在容器里面运行的进程也在宿主机上运行。但是容器里面的进程和宿主机上的相同的进程有不同的PID，因为容器使用其自己的 PID Linux namespace，有一个完全隔离的进程树（独立的 PID number序列）</p>
<p>类似的，容器的文件系统，网络接口等都是隔离的。</p>
<p>停止一个容器，首先停止容器中运行的主进程，然后停止容器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker stop 容器名字/容器ID</span><br></pre></td></tr></table></figure>

<p>删除一个容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker rm 容器名字/容器ID</span><br></pre></td></tr></table></figure>

<p>给镜像重命名（下面将busybox重命名为label/busybox）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker tag busybox label/busybox</span><br></pre></td></tr></table></figure>

<p>注意：不是重命名已有的镜像tag，而是对相同的镜像创建一个可选的名字，如下图所示（有相同的镜像ID）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">label/busybox       latest              219ee5171f80        9 days ago          1.23MB</span><br><span class="line">busybox             latest              219ee5171f80        9 days ago          1.23MB</span><br></pre></td></tr></table></figure>

<p>将镜像推倒远程仓库（之前需要 docker login）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker push label/busybox</span><br></pre></td></tr></table></figure>

<h2 id="配置Kubernetes集群"><a href="#配置Kubernetes集群" class="headerlink" title="配置Kubernetes集群"></a>配置Kubernetes集群</h2><p>接下来介绍2种简单的方式构建可运行的Kubernetes集群：在本机上运行的单节点的Kubernetes集群和访问一个运行在 Google Kuberne- tes Engine (GKE) 上的托管集群。当然还有其他的方式安装集群，例如利用<code>kubeadm</code>工具和<code>kops</code>工具（AWS）。</p>
<p>首先是利用<code>Minikube</code>工具在本机上运行一个单节点的Kubernetes集群，<code>Minikube</code>是最简单，最快捷的运行Kubernetes集群的方式。<code>Minikube</code>是一个构建单节点集群的工具，对于本地开发和测试Kubernetes集群都很有帮助。</p>
<p><code>Minikube</code>是一个需要下载并放到路径中的二进制文件，地址是<code>http://github.com/kubernetes/minikube</code>，例如在Linux系统上，利用下面命令进行下载和配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.15.0/minikube-linux-amd64</span><br><span class="line">sudo chmod +x minikube</span><br><span class="line">sudo mv minikube /usr/local/bin/</span><br></pre></td></tr></table></figure>

<p>启动Kubernetes集群之前需要安装<code>virtualbox</code>或者<code>kvm2</code></p>
<ul>
<li><p>首先检查机器处理器是否支持虚拟化</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">egrep -c '(vmx|svm)' /proc/cpuinfo</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<p>如果输出0，表示cpu不支持硬件虚拟化；输入大于0的值，表示支持，但是依然需要确保虚拟化使能。</p>
</li>
<li><p>查看cpu是不是64位的，以及查看正在运行的内核版本是不是64为的命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">egrep -c ' lm ' /proc/cpuinfo</span><br><span class="line">4  # 输出0表示cpu不是64位的，大于等于1表示是64位的</span><br><span class="line">uname -m</span><br><span class="line">x86_64 # 输出x86_64表示正在运行的内核版本是64位的</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装KVM</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils  # 安装依赖包</span><br><span class="line">sudo adduser `id -un` libvirt  # 将用户添加到libvirtd</span><br><span class="line">用户"yangliuqing"已经属于"libvirt"组。</span><br><span class="line">sudo adduser `id -un` kvm      # 将用户添加到KVM组</span><br><span class="line">正在添加用户"yangliuqing"到"kvm"组...</span><br><span class="line">正在将用户“yangliuqing”加入到“kvm”组中</span><br><span class="line">完成。</span><br><span class="line"><span class="meta">$</span><span class="bash"> groups                       <span class="comment"># 检查是否添加成功</span></span></span><br><span class="line">yangliuqing adm cdrom sudo dip plugdev kvm lpadmin lxd sambashare libvirt</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证是否安装成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all</span><br><span class="line">Id   Name   State</span><br><span class="line">--------------------</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>用下面的命令启动Kubernetes集群</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">minikube start</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改国内镜像源地址</span></span><br><span class="line">minikube start --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers</span><br></pre></td></tr></table></figure>

<p>安装<code>kubectl</code>客户端</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</span><br><span class="line">sudo chmod +x kubectl</span><br><span class="line">sudo mv kubectl /usr/local/bin/</span><br></pre></td></tr></table></figure>

<p>验证集群是否工作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl cluster-info</span></span><br><span class="line">Kubernetes control plane is running at https://192.168.39.225:8443</span><br><span class="line">KubeDNS is running at https://192.168.39.225:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br><span class="line"></span><br><span class="line">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span><br></pre></td></tr></table></figure>

<p>下面说明了如何和Kubernetes集群交互（3个节点）</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20210102175922445.png" alt="image-20210102175922445" style="zoom:50%;" />

<p>每一个节点都运行Docker、Kubelet、kube-proxy，通过<code>kubectl</code>客户端和集群交互。</p>
<p>列举集群中的节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get nodes</span></span><br><span class="line">NAME       STATUS   ROLES    AGE   VERSION</span><br><span class="line">minikube   Ready    master   18d   v1.19.4</span><br></pre></td></tr></table></figure>

<p>查看某个Kubernetes对象的详细信息，不加对象的名字，输出所有对象的信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe node minikube</span><br></pre></td></tr></table></figure>

<h2 id="在kubernetes上运行第一个程序"><a href="#在kubernetes上运行第一个程序" class="headerlink" title="在kubernetes上运行第一个程序"></a>在kubernetes上运行第一个程序</h2><p><strong>Pod</strong>: 一组紧密相关的容器，它们总是一起运行在同一个工作节点上，以及在同一个Linux命名空间。</p>
<p>每一个Pod像一个独立的逻辑机器，有其自己的IP，主机名，进程等，运行一个独立的应用。一个Pod里面的所有容器，似乎运行在相同的逻辑机器上，在其他Pod里面的容器（即使实际运行在同一个工作节点上）似乎运行在不同的逻辑机器上。下图显示了Pod，容器和节点间的关系。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20210102210302547.png" alt="image-20210102210302547" style="zoom:50%;" />

<p>Kubernetes中不能列举单个容器，但是可以列举Pods，用如下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get pods</span></span><br><span class="line">NAME    READY   STATUS              RESTARTS   AGE</span><br><span class="line">kubia   0/1     ContainerCreating   0          21s</span><br></pre></td></tr></table></figure>

<p> 查看Pod的详细信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl describe pod kubia</span></span><br></pre></td></tr></table></figure>

<p>下图显示了在集群上运行容器镜像的过程</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20210102220759542.png" alt="image-20210102220759542" style="zoom:50%;" />

<p>分2步，第一步是构建镜像，并将其放到仓库中；第二步，通过kubectl在集群上运行容器镜像。</p>
<p>访问一个Pod，首先需要通过一个服务对象暴露Pod的IP地址，命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl expose rc kubia --<span class="built_in">type</span>=LoadBalancer --name kubia-http  <span class="comment"># rc表示 replicationcontrollers</span></span></span><br></pre></td></tr></table></figure>

<p>查看Kubernetes上的服务对象</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get services</span></span><br></pre></td></tr></table></figure>

<p>下图总结了本小节提到的Replicationcontroller，Pod和服务的关系</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记//image-20210102224206466.png" alt="image-20210102224206466" style="zoom:50%;" />

<ul>
<li>Pod和容器：Pod里面可以包含任意个容器（上面图中是一个），Pod有其自己独立的IP和主机名</li>
<li>Replicationcontroller的角色：确保总是有指定数目的Pod实例在运行（图中是一个），一般来说Replicationcontroller用来创建多个Pod的拷贝，如果由于某些原因Pod消失了，则Replicationcontroller创建一个新的</li>
<li>为什么需要服务：当Pod由于某些原因消失了，被Replicationcontroller创建一个新的替代，则新的Pod有新的IP，主机名等，这时候服务确保某一个Pod收到客户端的连接，（服务的IP是固定的，不会变化）。服务表示一个静态的位置对于一个或者多个提供相同服务的Pod</li>
</ul>
<p>上面的Pod被Replicationcontroller管理，通过下面的命令查看Pod的数目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get replicationcontrollers</span></span><br></pre></td></tr></table></figure>

<p>通过下面的命令对Pod进行扩容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl scale rc kubia --replicas=3</span></span><br></pre></td></tr></table></figure>

<p>下图是扩容后的关系图</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes学习笔记/image-20210102231125231.png" alt="image-20210102231125231" style="zoom:50%;" />

<p>下图的命令可以查看Pod在哪一个节点上运行，以及Pod的IP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get pods -o wide  <span class="comment"># 也可以通过 kubectl describe pod &lt;pod_name&gt;查看</span></span></span><br><span class="line">NAME     READY   STATUS             RESTARTS   AGE    IP           NODE       NOMINATED NODE   READINESS GATES</span><br><span class="line">kubia    0/1     CrashLoopBackOff   15         125m   172.17.0.3   minikube   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kubia1   0/1     ImagePullBackOff   0          49m    172.17.0.4   minikube   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>如果使用minikube，通过下面的命令打开dashboard</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> minikube dashboard</span></span><br></pre></td></tr></table></figure>

<h1 id="Pods-在Kubernetes上运行容器"><a href="#Pods-在Kubernetes上运行容器" class="headerlink" title="Pods: 在Kubernetes上运行容器"></a>Pods: 在Kubernetes上运行容器</h1><h2 id="Pod简介"><a href="#Pod简介" class="headerlink" title="Pod简介"></a>Pod简介</h2><p>Pod是一组相关的容器，是Kubernetes的基本组成部分，在Kubernetes上并不是直接操作容器，而是Pod。一个Pod包含一个或多个容器，当一个Pod包含多个容器的时候，所有的容器都运行在一个相同的节点上，不会跨节点，如下图所示</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210105002032549.png" alt="image-20210105002032549" style="zoom:50%;" />

<p>推荐一个容器里面只运行一个进程（一个应用），对于多个进程的应用（需要多个容器）需要一个上层的结构把多个容器作为一个单元进行管理，这个上层的结构就是Pod。一个包含容器的Pod可以运行紧密相关的多个进程，给他们提供相同的环境，就像运行在一个容器里面一样，同时在某种程度上保证了隔离。</p>
<p>相同Pod里面容器的部分隔离：一个Pod里面的容器可以共享某些资源，Kubernetes使得一个Pod里面的容器共享相同的某些Linux namesapce实现容器共享某些资源，从而实现部分隔离，例如一个Pod里面的容器运行在相同的Network和UTS命名空间，使得容器共享相同的hostname和网络接口，运行在相同的IPC命名空间，可以利用IPC进行通信。默认是不共享PID命名空间的，所以Pod里面的容器里面的进程是完全隔离的。容器里面的文件系统是完全隔离的（容器的文件系统来自容器镜像），但是可以通过<code>Volume</code>的方式共享文件目录。</p>
<p>需要注意的是，一个Pod里面的容器共享相同的网络空间，它们共享相同的IP地址和port空间，也就是说一个Pod里面的容器里面的程序不能绑定相同的端口，否则会导致端口冲突（不同的Pod里面的容器没有端口冲突问题，因为是隔离的，每一个Pod有独立的port空间）。一个Pod里面的容器可以通过localhost互相通信。</p>
<p>Kubernetes集群中所有Pod的网络结构如下，Pod之间可以通过各自的IP地址访问，没有NAT网关存在。Pod间的通信类似于局域网（LAN），每一个Pod有其自己的IP地址。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210106003109697.png" alt="image-20210106003109697" style="zoom:50%;" />

<p>Pods是逻辑主机，行为就像物理主机或者虚拟机。运行在同一个Pod里面的进程就像运行在同一个物理机或者虚拟机里面的进程，只是一个容器里面一个进程（建议）。</p>
<p>可以将Pod看成一个独立的机器，只是每一个Pod部署一个应用。Pod是轻量级的，不必担心负载，不要把所有的东西都放在一个Pod里面，应该将应用拆分为多个Pod。例如一个应用包含一个前端服务和一个后端数据服务，应该拆分为2个Pod，一个运行前端服务，一个运行后端数据服务。原因如下：</p>
<ol>
<li>如果将前端服务和后端服务放在一个Pod里面，则两个服务总是会运行在一个机器上，如果Kubernetes集群有2个节点，这个唯一的Pod只会运行在一个节点上，不能利用另一个节点的资源。如果划分为2个Pod，则Kubernetes会将前端服务Pod调度到一个节点上，后端服务Pod调度到另一个节点上，提高资源利用率；</li>
<li>拆分为多个Pod方便扩缩容。Pod是Kubernetes扩缩容的基本单位，如果前端服务和后端服务在一个Pod里面，则扩容后，前端服务和后端服务都扩容了，实际情况是前端服务和后端服务扩缩容的需求不同，应该分别扩缩容，且通常后端服务扩缩容更加困难。因此如果想独立扩缩容一个容器，则这个容器应该放在一个单独的Pod里面</li>
</ol>
<p>如果在一个Pod里面运行多个容器，则这个应用应该有一个主进程和一个或多个附加进程（一个进程一个容器），如下图</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210106221329104.png" alt="image-20210106221329104" style="zoom:50%;" />

<p>例如，在Pod里面的主容器是一个Web服务，从一个特定的文件目录服务文件，一个附加的容器周期下载数据存储在这个Web服务的目录里面。当决定在一个Pod里面运行多个容器还是拆分为多个Pod，应该自问3个问题：</p>
<ol>
<li>它们需要在一起运行吗，或者它们可以运行在不同的主机上吗？</li>
<li>它们必须一起扩缩容还是独立扩缩容？</li>
<li>它们代表一个整体还是独立的组件？</li>
</ol>
<p><strong>一般来说一个Pod里面运行一个容器</strong>，除非有特殊的原因，下图是上面例子的说明</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210106222244565.png" alt="image-20210106222244565" style="zoom:50%;" />

<h2 id="从YAML或者JSON文件创建Pod"><a href="#从YAML或者JSON文件创建Pod" class="headerlink" title="从YAML或者JSON文件创建Pod"></a>从YAML或者JSON文件创建Pod</h2><p>从yaml文件或者json文件可以创建Pod，通过将文件post到Kubernetes REST API。配置所有种类的资源，需要理解Kubernetes API对象定义，<a href="http://kubernetes.io/docs/reference/" target="_blank" rel="noopener">参考官方网址</a>。</p>
<p>使用下面的命令查看一个Pod的全部YAML定义</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po kubia-dlzv4 -o yaml <span class="comment"># 如果看json返回格式的使用命令 kubectl get po kubia-dlzv4 -o json</span></span></span><br></pre></td></tr></table></figure>

<p>Pod的定义由几部分组成：在YAML中使用的Kubernetes API的版本；YAML里面描述的资源类型；以及下面的三个部分：</p>
<ol>
<li><em>Metadata</em>：包括名字，命名空间，labels，关于Pod的其他信息；</li>
<li><em>Spec</em>：包含Pod内容的实际描述，例如Pod的容器，卷以及其他数据；</li>
<li><em>Status</em>：包含当前正在运行Pod的当前信息，例如容器状态和描述，Pod处于什么状态（条件），Pod的内部IP地址以及其它基本信息</li>
</ol>
<p>当创建一个新Pod，不需要提供status部分，下面介绍的是创建一个Pod的最基本的YAML</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210109230902658.png" alt="image-20210109230902658" style="zoom:50%;" />

<p>上面是一个简单的Pod的YAML文件，Kubernetes API版本是v1，资源类型是Pod，名字是kubik-manual。在Pod定义里面指定ports纯粹是装饰信息，可以不写。</p>
<p>查看API对象（例如Pod）支持的属性方法要么通过<a href="http://kubernetes.io/docs/api" target="_blank" rel="noopener">官方文档</a>或者通过<code>kubectl explain</code>命令，例如下面查看Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl explain pods</span></span><br><span class="line">KIND:     Pod</span><br><span class="line">VERSION:  v1</span><br><span class="line"></span><br><span class="line">DESCRIPTION:</span><br><span class="line">     Pod is a collection of containers that can run on a host. This resource is</span><br><span class="line">     created by clients and scheduled onto hosts.</span><br><span class="line"></span><br><span class="line">FIELDS:</span><br><span class="line">   apiVersion	&lt;string&gt;</span><br><span class="line">     APIVersion defines the versioned schema of this representation of an</span><br><span class="line">     object. Servers should convert recognized schemas to the latest internal</span><br><span class="line">     value, and may reject unrecognized values. More info:</span><br><span class="line">     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</span><br><span class="line"></span><br><span class="line">   kind	&lt;string&gt;</span><br><span class="line">     Kind is a string value representing the REST resource this object</span><br><span class="line">     represents. Servers may infer this from the endpoint the client submits</span><br><span class="line">     requests to. Cannot be updated. In CamelCase. More info:</span><br><span class="line">     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</span><br><span class="line"></span><br><span class="line">   metadata	&lt;Object&gt;</span><br><span class="line">     Standard object's metadata. More info:</span><br><span class="line">     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata</span><br><span class="line"></span><br><span class="line">   spec	&lt;Object&gt;</span><br><span class="line">     Specification of the desired behavior of the pod. More info:</span><br><span class="line">     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span><br><span class="line"></span><br><span class="line">   status	&lt;Object&gt;</span><br><span class="line">     Most recently observed status of the pod. This data may not be up to date.</span><br><span class="line">     Populated by the system. Read-only. More info:</span><br><span class="line">     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span><br></pre></td></tr></table></figure>

<p>当然也可以进一步查看对象属性的解释，如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl explain pod.spec</span></span><br><span class="line">KIND:     Pod</span><br><span class="line">VERSION:  v1</span><br><span class="line"></span><br><span class="line">RESOURCE: spec &lt;Object&gt;</span><br><span class="line"></span><br><span class="line">DESCRIPTION:</span><br><span class="line">     Specification of the desired behavior of the pod. More info:</span><br><span class="line">     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span><br><span class="line"></span><br><span class="line">     PodSpec is a description of a pod.</span><br><span class="line"></span><br><span class="line">FIELDS:</span><br><span class="line">   activeDeadlineSeconds	&lt;integer&gt;</span><br><span class="line">     Optional duration in seconds the pod may be active on the node relative to</span><br><span class="line">     StartTime before the system will actively try to mark it failed and kill</span><br><span class="line">     associated containers. Value must be a positive integer.</span><br><span class="line"></span><br><span class="line">   affinity	&lt;Object&gt;</span><br><span class="line">     If specified, the pod's scheduling constraints</span><br><span class="line"></span><br><span class="line">   automountServiceAccountToken	&lt;boolean&gt;</span><br><span class="line">     AutomountServiceAccountToken indicates whether a service account token</span><br><span class="line">     should be automatically mounted.</span><br><span class="line"></span><br><span class="line">   containers	&lt;[]Object&gt; -required-</span><br><span class="line">     List of containers belonging to the pod. Containers cannot currently be</span><br><span class="line">     added or removed. There must be at least one container in a Pod. Cannot be</span><br><span class="line">     updated.</span><br><span class="line"></span><br><span class="line">   .....</span><br><span class="line">   .....</span><br><span class="line"></span><br><span class="line">   volumes	&lt;[]Object&gt;</span><br><span class="line">     List of volumes that can be mounted by containers belonging to the pod.</span><br><span class="line">     More info: https://kubernetes.io/docs/concepts/storage/volumes</span><br></pre></td></tr></table></figure>

<p>使用下面的命令从一个YAML文件创建Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl create -f kubia-manual.yaml  <span class="comment"># kubectl create -f 可以用于创建任何资源，不仅仅是Pod</span></span></span><br></pre></td></tr></table></figure>

<p>查看Kubernetes中Pod的日志是方便的（Pod中只运行一个容器），使用下面的命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl logs kubia-manual</span></span><br><span class="line">Kubia server starting...</span><br></pre></td></tr></table></figure>

<p>容器的日志每天自动轮替（或者大小达到10MB），kubectl logs 命令显示最后一次的轮替。</p>
<p>如果Pod包含多个容器的时候，当查询日志的时候需要显示指定容器的名字，添加-c <container name>选项，例如下面的命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl logs kubia-manual -c kubia</span></span><br><span class="line">Kubia server starting...</span><br></pre></td></tr></table></figure>

<p>注意：kubectl logs 命令只能查看已存在Pod的日志，当Pod被删除的时候，其日志也被删除。后面的章节会介绍如何查看被删除Pod的日志。</p>
<p>通过<strong>端口转发</strong>可以访问Pod（通过服务的方式后面会介绍），使用<code>kubectl port-forward</code>命令实现</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl port-forward kubia-manual 8888:8080  <span class="comment">#  转发本地端口8888到Pod里面的8080端口</span></span></span><br><span class="line">Forwarding from 127.0.0.1:8888 -&gt; 8080</span><br><span class="line">Forwarding from [::1]:8888 -&gt; 8080</span><br></pre></td></tr></table></figure>

<p>在本机打开一个新的终端给Pod一个HTTP请求，如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl localhost:8888</span></span><br></pre></td></tr></table></figure>

<p>下图是Pod转发的示意图</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210110230958833.png" alt="image-20210110230958833" style="zoom:50%;" />

<h2 id="利用标签组织Pods"><a href="#利用标签组织Pods" class="headerlink" title="利用标签组织Pods"></a>利用标签组织Pods</h2><p>随着在集群上运行的Pod越来越多（或者其他的Kubernetes对象），有必要对其进程组织分类，可以通过<code>labels</code>实现</p>
<p><code>labels</code>是一种简单但功能强大的Kubernetes功能，不仅可以组织容器，还可以组织所有其他Kubernetes资源，标签是一个附加到资源上的任意的键-值对。标签选择器通过标签选择资源，一个资源可以有多个标签，标签的key是唯一的。通常创建资源的时候会附加一个标签，之后也可以添加附加的标签或者修改标签的值，而不必要重新创建资源。</p>
<p>下面是给众多Pods加标签的例子，通过标签使得系统结构更加清新，下面的每一个Pod都有2个label</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210113000947943.png" alt="image-20210113000947943" style="zoom:50%;" />

<ul>
<li>app: 表示Pod属于哪一个app，或者组件或者微服务；</li>
<li>rel: 表示在Pod里面的应用是稳定版本，beta版本还是 canary release版本</li>
</ul>
<p>创建Pod的时候可以指定label，下面的yaml文件指定的创建Pod的2个label，分别是<code>creation_method=manual</code>和<code>env=prod</code></p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210113002250294.png" alt="image-20210113002250294" style="zoom:50%;" />

<p>使用下面的命令创建Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl create -f kubia-manual-with-labels.yaml</span></span><br></pre></td></tr></table></figure>

<p>使用下面的命令查看Pod并显示label</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po --show-labels</span></span><br></pre></td></tr></table></figure>

<p>也可以使用<code>-L</code>开关显示某些label，例如下面的命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po -L creation_method,env</span></span><br></pre></td></tr></table></figure>

<p>对于存在的Pod，可以添加或者修改labels，例如下面的命令给 kubia-manual Pod添加 creation_method=manual 标签</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl label po kubia-manual creation_method=manual</span></span><br></pre></td></tr></table></figure>

<p>下面的命令是修改Pod kubia-manual-v2 的 env=prod 标签为 env=debug</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl label po kubia-manual-v2 env=debug --overwrite</span></span><br></pre></td></tr></table></figure>

<h2 id="通过标签选择器列举Pod的子集"><a href="#通过标签选择器列举Pod的子集" class="headerlink" title="通过标签选择器列举Pod的子集"></a>通过标签选择器列举Pod的子集</h2><p> 标签选择器可以根据某些特定的标签选择Pod的子集，进而在选择的Pod的进行操作。标签选择器可以根据下面3种资源情况进行选择</p>
<ul>
<li>包含（或者不包含）带有特定key的标签；</li>
<li>包含带有特定key和value的标签；</li>
<li>包含带有特定key，但是value不是指定的</li>
</ul>
<p>查看带有标签<code>creation_method=manual</code>的所有Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po -l creation_method=manual</span></span><br></pre></td></tr></table></figure>

<p>查看包含 key 是 env 的标签的所有Pod（忽略标签的value）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po -l env</span></span><br></pre></td></tr></table></figure>

<p>查看没有 env 标签的所有Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po -l <span class="string">'!env'</span>  <span class="comment"># 注意 !env 必须在单引号里面</span></span></span><br></pre></td></tr></table></figure>

<p>类似地，可以用下面的标签选择器匹配Pods</p>
<ul>
<li><code>creation_method!=manual</code>选择有 creation_method 标签，但是值不是 manual 的Pod;</li>
<li><code>env in (prod,devel)</code>选择有标签在集合<code>(prod,devel)</code> 中的Pod；</li>
<li><code>env notin (prod,devel)</code>选择标签不在集合<code>(prod,devel)</code> 中的Pod;</li>
</ul>
<p>下图是使用标签选择器的例子</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210116225057601.png" alt="image-20210116225057601" style="zoom:50%;" />

<p>当然，标签选择器可以使用多个条件规则，每一个条件都必须满足才会选择，下图显示了同时满足<code>app=pc,rel=beta</code>的条件的Pod</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210116225406676.png" alt="image-20210116225406676" style="zoom:50%;" />

<p>标签选择器不仅仅可以查看某些Pod，也可以在选择的Pod上执行某些操作，例如后面会展示利用标签选择器同时删除多个Pod。</p>
<h2 id="利用标签和选择器约束Pod的调度"><a href="#利用标签和选择器约束Pod的调度" class="headerlink" title="利用标签和选择器约束Pod的调度"></a>利用标签和选择器约束Pod的调度</h2><p>有时候需要Pod运作在某些特定的节点上，比如运行在有GPU的节点上，这可以通过描述对节点的要求，让Kubernetes选择符合要求的节点实现。Kubernetes通过节点标签和节点选择器实现选择特定的节点。</p>
<p>可以使用标签组织工作节点，标签可以添加到任何Kubernetes对象上，例如节点，Pod等资源。节点添加到集群一般都会给节点一个标签。下面的命令给节点 gke-kubia-85f6-node-0rrx 添加标签<code>gpu=true</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl label node gke-kubia-85f6-node-0rrx gpu=<span class="literal">true</span></span></span><br></pre></td></tr></table></figure>

<p>类似地可以用下面的命令显示标签为<code>gpu=true</code>的节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get nodes -l gpu=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令 kubectl get nodes -L gpu 会多显示一列，指示标签key为gpu的值</span></span><br></pre></td></tr></table></figure>

<p>在YAML文件中添加节点选择器，让Kubernetes调度器在指定标签的节点中选择，例如下面的YAML文件，在 spec 下面添加 nodeSelector 字段。</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210117175840479.png" alt="image-20210117175840479" style="zoom:50%;" />

<p>当然，也可以调度一个Pod到一个具体特定的节点，因为每一个节点有一个独一无二标签，其中 key=kubernetes.io/hostname，值是具体的节点的 hostname。注意，当通过 hostname 标签在nodeSelector 字段中指定一个特点的节点，可能会导致Pod不可调度，如果节点是离线的话。<strong>建议：不要设置单个节点</strong></p>
<h2 id="注解Pod"><a href="#注解Pod" class="headerlink" title="注解Pod"></a>注解Pod</h2><p>Pod和其他的Kubernetes对象除了可以添加标签，也可以添加注解。注解也是 key-value 对，注解只是起到说明作用的，可以类比代码里面的注释。</p>
<p>注解可以在创建Pod的时候添加，也可以在已经存在的Pod上添加或者修改。最简单的方法是使用<code>kubectl annotate</code>命令在已经存在的Pod上添加一个注解。例如下面的命令是在Pod <code>kubia-manual</code>上添加一个注解</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl annotate pod kubia-manual mycompany.com/someannotation=<span class="string">"foo bar"</span></span></span><br><span class="line">pod/kubia-manual annotated</span><br></pre></td></tr></table></figure>

<p>建议使用 mycompany.com/someannotation 格式的key添加注解，以避免 key 的冲突。可以使用 <code>kubectl describe</code>命令查看添加的注解，如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl describe pod kubia-manual</span></span><br><span class="line">Name:         kubia-manual</span><br><span class="line">Namespace:    default</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         minikube/192.168.39.243</span><br><span class="line">Start Time:   Sun, 17 Jan 2021 18:43:25 +0800</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  mycompany.com/someannotation: foo bar</span><br><span class="line">Status:       Pending</span><br><span class="line">IP:           172.17.0.3</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="使用命名空间分组资源"><a href="#使用命名空间分组资源" class="headerlink" title="使用命名空间分组资源"></a>使用命名空间分组资源</h2><p>标签可以将资源对象进行分组，由于一个资源对象可以有多个标签，分组是重叠的。使用Kubernetes的命名空间可以将资源分组，且不重叠，在不同的命名空间中，资源可以有相同的名字。使用命名空间可以将资源对象分为不同的环境，比如：开发，测试，线上等。大多数的资源对象都可以使用命名空间，但是有些不能，比如节点资源。</p>
<p>使用下面的命令查看集群上所有的命名空间</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get ns</span></span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   3h29m</span><br><span class="line">kube-node-lease   Active   3h30m</span><br><span class="line">kube-public       Active   3h30m</span><br><span class="line">kube-system       Active   3h30m</span><br></pre></td></tr></table></figure>

<p>当使用命令<code>kubectl get</code>查看资源，且没有指定命名空间的话，Kubernetes 默认使用<code>default</code>命名空间，只显示在<code>default</code>空间里面的资源。可以显示指定命名空间，如下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po --namespace kube-system</span></span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-f9fd979d6-d82n9            1/1     Running   0          3h33m</span><br><span class="line">etcd-minikube                      1/1     Running   0          3h33m</span><br><span class="line">kube-apiserver-minikube            1/1     Running   0          3h33m</span><br><span class="line">kube-controller-manager-minikube   1/1     Running   1          3h34m</span><br><span class="line">kube-proxy-btfdr                   1/1     Running   0          3h33m</span><br><span class="line">kube-scheduler-minikube            1/1     Running   0          3h33m</span><br></pre></td></tr></table></figure>

<p>命名空间可以隔离资源，避免误操作，也使得资源可以更加有效管理。除了隔离资源，命名空间还有其他作用，后面章节会介绍。</p>
<p>命名空间也是一种Kubernetes资源，在YAML文件里面可以指定，如下面例子</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210117220820299.png" alt="image-20210117220820299" style="zoom:50%;" />

<p>使用下面的命令创建命名空间资源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl create -f custom-namespace.yaml</span></span><br><span class="line">namespace/custom-namespace created</span><br></pre></td></tr></table></figure>

<p>也可以通过<code>kubectl create namespace</code>命令直接创建命名空间，如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl create namespace custom-namespace</span></span><br></pre></td></tr></table></figure>

<p>在特定的命名空间创建资源，可以在YAML文件的<code>metadata</code>部分下面添加<code>namespace: custom- namespace</code>一项，或者直接在使用命令的时候指定命名空间，如下所示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl create -f kubia-manual.yaml -n custom-namespace</span></span><br><span class="line">pod/kubia-manual created</span><br></pre></td></tr></table></figure>

<p>在某些命名空间对资源进行查看，修改，删除等操作时候，需要在命令中使用<code>--namespace (or -n)</code>标志指定命名空间，否则的话Kubernetes使用默认的命名空间（Kubernetes的默认配置可以通过<code>kubectl config</code>命令修改）。如下面的例子</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get pods  <span class="comment"># 默认命令空间</span></span></span><br><span class="line">NAME           READY   STATUS    RESTARTS   AGE</span><br><span class="line">kubia-dmckq    1/1     Running   0          3h35m</span><br><span class="line">kubia-l2mdl    1/1     Running   0          3h35m</span><br><span class="line">kubia-manual   1/1     Running   0          3h36m</span><br><span class="line">kubia-zs8hz    1/1     Running   0          3h35m</span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl get pods -n custom-namespace</span></span><br><span class="line">NAME           READY   STATUS    RESTARTS   AGE</span><br><span class="line">kubia-manual   1/1     Running   0          110s</span><br></pre></td></tr></table></figure>

<p><strong>注意：命名空间不提供对正在运行对象的任何隔离，例如在不同命名空间里面的Pod是可以互相通行的</strong></p>
<h2 id="停止和删除Pods"><a href="#停止和删除Pods" class="headerlink" title="停止和删除Pods"></a>停止和删除Pods</h2><p>可以直接通过Pod的名字删除Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl delete po kubia-gpu  <span class="comment"># 可以删除多个Pod，通过空格分开 kubectl delete po pod1 pod2</span></span></span><br></pre></td></tr></table></figure>

<p>上述的命令指示Kubernetes终止在删除Pod里面的所有容器。Kubernetes给进程发<code>SIGTERM</code>信号，然后等待一定的时间（默认30s）优雅地删除。如果在等待的时间里没有删除，那么进程会被杀掉通过<code>SIGKILL</code>信号，为了确保进程优雅地退出，需要合理地处理<code>SIGTERM</code>命令。</p>
<p>也可以通过标签选择器来删除Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl delete po -l rel=canary</span></span><br></pre></td></tr></table></figure>

<img src="https://muyi110.github.io/shanliu.github.io/images/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0//image-20210117224603607.png" alt="image-20210117224603607" style="zoom:50%;" />

<p>也可以删除整个命名空间，进而自动删除里面所有的Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl delete ns custom-namespace</span></span><br></pre></td></tr></table></figure>

<p>可以删除命名空间里面的所有Pod，但是保留命令空间</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl delete po --all</span></span><br></pre></td></tr></table></figure>

<p>删除命令空间里面的所有资源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl delete all --all  <span class="comment"># 指定all实际不能删除所有的资源，比如Secrets就需要显示指定删除</span></span></span><br></pre></td></tr></table></figure>

<h1 id="Replication-And-other-controllers：部署托管的Pods"><a href="#Replication-And-other-controllers：部署托管的Pods" class="headerlink" title="Replication And other controllers：部署托管的Pods"></a>Replication And other controllers：部署托管的Pods</h1><h2 id="保持Pods健康"><a href="#保持Pods健康" class="headerlink" title="保持Pods健康"></a>保持Pods健康</h2><p>使用Kubernetes最主要的好处是可以使得容器在集群上自动运行。当一个Pod被调度到一个节点上，节点上的Kubelte会运行此Pod的容器，并且只要Pod存在，会使得里面的容器一直运行（如果Pod里面的容器挂了，Kubelte会重启容器）。当容器里面的程序有问题，容器本身正常（主进程还在），<strong>可以在程序内部捕获这种异常情况，使得容器退出，进而利用Kubernetes重启容器</strong>。但是，如果程序进入死循环或者死锁，需要在外面检查程序的健康情况了。</p>
<p>存活探针</p>
<p>Kubernetes可以通过存活探针检查一个容器是否活着，可以给Pod里面的每一个容器指定存活探针，Kubernetes可以周期性执行探测，如果探测失败会重启容器。</p>
<p>Kubernetes有3种方式探测一个容器：</p>
<ul>
<li>HTTP GET 探测：在指定的容器IP，端口和路径执行HTTP GET请求，如果收到一个非错误的响应，则认为探测成功，否则认为失败，容器会被重启；</li>
<li>TCP Socker探测：向指定的容器端口建立一个TCP连接，如果连接被成功建立则成功，否则容器被重启；</li>
<li><em>Exec</em> 探测：在容器里面执行任意一个命令，退出码为0表示探测成功，否则失败，容器被重启；</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://muyi110.github.io/shanliu.github.io/2020/vim%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/shanliu.github.io/images/wukong.png">
      <meta itemprop="name" content="山柳">
      <meta itemprop="description" content="既已无岸，不必回头，唯有向前，踏碎云霄，放肆桀骜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山柳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/shanliu.github.io/2020/vim%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">vim配置</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-04 18:51:05" itemprop="dateCreated datePublished" datetime="2020-07-04T18:51:05+08:00">2020-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-07 10:45:50" itemprop="dateModified" datetime="2020-07-07T10:45:50+08:00">2020-07-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/shanliu.github.io/categories/vim/" itemprop="url" rel="index"><span itemprop="name">vim</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>此博客记录开发过程中的vim的配置（针对<code>vim8</code>），后续会随时更新</p>
</blockquote>
<h1 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h1><ul>
<li>LeaderF（模糊搜索）</li>
<li>NERDTree（工程目录）</li>
<li>Vim-flake8（用于python语法，风格，复杂度检查）</li>
<li>Vim-polyglot（支持多种语言语法高亮）</li>
<li>Vim_airline（设置vim中状态栏）</li>
</ul>
<p>在vim8版本中，插件需要放到<code>.vim</code>文件的<code>start</code>目录中，例如：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/.vim/pack/vendor/start/</span><br></pre></td></tr></table></figure>

<p>需要配合安装以下软件</p>
<ul>
<li>Flake8</li>
<li>Jq</li>
</ul>
<h1 id="Flake8配置"><a href="#Flake8配置" class="headerlink" title="Flake8配置"></a>Flake8配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/.config/flake8</span><br></pre></td></tr></table></figure>

<p>配置文件如下</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[flake8]</span><br><span class="line"><span class="built_in">max</span>-<span class="built_in">line</span>-length=<span class="number">130</span></span><br><span class="line">max_complexity = <span class="number">30</span></span><br><span class="line">ignore=E402</span><br><span class="line">format=default</span><br></pre></td></tr></table></figure>

<h1 id="插件修改"><a href="#插件修改" class="headerlink" title="插件修改"></a>插件修改</h1><p>Vim-polyglot插件中python.vim在注释高亮增加下面一行</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syn region pythonComment   start=+<span class="string">''</span><span class="string">'+ skip=+\\'</span>+ end=+<span class="string">''</span><span class="string">'+ contained containedin=pythonString</span></span><br></pre></td></tr></table></figure>

<h1 id="Vimrc文件配置"><a href="#Vimrc文件配置" class="headerlink" title=".Vimrc文件配置"></a>.Vimrc文件配置</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">number</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">ts</span>=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> hlsearch</span><br><span class="line"><span class="keyword">syntax</span> <span class="keyword">on</span></span><br><span class="line"><span class="keyword">filetype</span> <span class="keyword">on</span></span><br><span class="line"><span class="keyword">filetype</span> plugin <span class="built_in">indent</span> <span class="keyword">on</span></span><br><span class="line"><span class="keyword">set</span> ruler</span><br><span class="line"><span class="keyword">set</span> cursorline</span><br><span class="line"><span class="keyword">set</span> autoindent</span><br><span class="line"><span class="keyword">set</span> nocompatible</span><br><span class="line"><span class="keyword">set</span> expandtab</span><br><span class="line"><span class="keyword">set</span> <span class="built_in">shiftwidth</span>=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> backspace=<span class="number">2</span></span><br><span class="line"><span class="keyword">set</span> t_Co=<span class="number">256</span></span><br><span class="line"><span class="comment">" 高亮设置</span></span><br><span class="line"><span class="keyword">hi</span> LineNr ctermfg=grey</span><br><span class="line"><span class="keyword">hi</span> clear cursorline</span><br><span class="line"><span class="keyword">hi</span> CursorLineNr ctermfg=yellow cterm=Bold</span><br><span class="line"><span class="keyword">hi</span> CursorLine cterm=NONE</span><br><span class="line"><span class="keyword">hi</span> VertSplit ctermfg=<span class="number">241</span> ctermbg=<span class="number">241</span> cterm=NONE guifg=#<span class="number">64645</span><span class="keyword">e</span> guibg=#<span class="number">64645</span><span class="keyword">e</span> <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> MatchParen ctermfg=<span class="number">197</span> ctermbg=NONE cterm=underline guifg=#f92672 guibg=NONE <span class="keyword">gui</span>=underline</span><br><span class="line"><span class="keyword">hi</span> Search term=<span class="built_in">reverse</span> cterm=NONE ctermfg=<span class="number">231</span> ctermbg=<span class="number">24</span> <span class="keyword">gui</span>=NONE guifg=#f8f8f2 guibg=#<span class="number">204</span>a87</span><br><span class="line"><span class="keyword">hi</span> Directory ctermfg=<span class="number">231</span> ctermbg=NONE cterm=NONE guifg=#ae81ff guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Boolean ctermfg=<span class="number">141</span> ctermbg=NONE cterm=NONE guifg=#ae81ff guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Character ctermfg=<span class="number">141</span> ctermbg=NONE cterm=NONE guifg=#ae81ff guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Comment ctermfg=<span class="number">245</span> ctermbg=NONE cterm=NONE guifg=#<span class="number">75715</span><span class="keyword">e</span> guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Conditional ctermfg=<span class="number">197</span> ctermbg=NONE cterm=NONE guifg=#f92672 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Constant ctermfg=NONE ctermbg=NONE cterm=NONE guifg=NONE guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Define ctermfg=<span class="number">197</span> ctermbg=NONE cterm=NONE guifg=#f92672 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> DiffAdd ctermfg=<span class="number">231</span> ctermbg=<span class="number">64</span> cterm=bold guifg=#f8f8f2 guibg=#<span class="number">46830</span><span class="keyword">c</span> <span class="keyword">gui</span>=bold</span><br><span class="line"><span class="keyword">hi</span> DiffDelete ctermfg=<span class="number">88</span> ctermbg=NONE cterm=NONE guifg=#<span class="number">8</span>b0807 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> DiffChange ctermfg=NONE ctermbg=NONE cterm=NONE guifg=#f8f8f2 guibg=#<span class="number">243955</span> <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> DiffText ctermfg=<span class="number">231</span> ctermbg=<span class="number">24</span> cterm=bold guifg=#f8f8f2 guibg=#<span class="number">204</span>a87 <span class="keyword">gui</span>=bold</span><br><span class="line"><span class="keyword">hi</span> ErrorMsg ctermfg=<span class="number">231</span> ctermbg=<span class="number">197</span> cterm=NONE guifg=#f8f8f0 guibg=#f92672 <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> WarningMsg ctermfg=<span class="number">231</span> ctermbg=<span class="number">197</span> cterm=NONE guifg=#f8f8f0 guibg=#f92672 <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Float ctermfg=<span class="number">141</span> ctermbg=NONE cterm=NONE guifg=#ae81ff guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Function ctermfg=<span class="number">45</span> ctermbg=NONE cterm=NONE guifg=#a6e22e guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Identifier ctermfg=<span class="number">172</span> ctermbg=NONE cterm=NONE guifg=#<span class="number">66</span>d9ef guibg=NONE <span class="keyword">gui</span>=italic</span><br><span class="line"><span class="keyword">hi</span> Keyword ctermfg=<span class="number">197</span> ctermbg=NONE cterm=NONE guifg=#f92672 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Label ctermfg=<span class="number">186</span> ctermbg=NONE cterm=NONE guifg=#e6db74 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Number ctermfg=<span class="number">141</span> ctermbg=NONE cterm=NONE guifg=#ae81ff guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Operator ctermfg=<span class="number">197</span> ctermbg=NONE cterm=NONE guifg=#f92672 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> PreProc ctermfg=<span class="number">197</span> ctermbg=NONE cterm=NONE guifg=#f92672 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Special ctermfg=<span class="number">231</span> ctermbg=NONE cterm=NONE guifg=#f8f8f2 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> SpecialComment ctermfg=<span class="number">242</span> ctermbg=NONE cterm=NONE guifg=#<span class="number">75715</span><span class="keyword">e</span> guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Statement ctermfg=<span class="number">197</span> ctermbg=NONE cterm=NONE guifg=#f92672 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> StorageClass ctermfg=<span class="number">81</span> ctermbg=NONE cterm=NONE guifg=#<span class="number">66</span>d9ef guibg=NONE <span class="keyword">gui</span>=italic</span><br><span class="line"><span class="keyword">hi</span> String ctermfg=<span class="number">226</span> ctermbg=NONE cterm=NONE guifg=#e6db74 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Tag ctermfg=<span class="number">197</span> ctermbg=NONE cterm=NONE guifg=#f92672 guibg=NONE <span class="keyword">gui</span>=NONE</span><br><span class="line"><span class="keyword">hi</span> Todo ctermfg=<span class="number">95</span> ctermbg=NONE cterm=inverse,bold guifg=#<span class="number">75715</span><span class="keyword">e</span> guibg=NONE <span class="keyword">gui</span>=inverse,bold</span><br><span class="line"><span class="keyword">hi</span> Underlined ctermfg=NONE ctermbg=NONE cterm=underline guifg=NONE guibg=NONE <span class="keyword">gui</span>=underline</span><br><span class="line"></span><br><span class="line"><span class="comment">" 快捷键映射</span></span><br><span class="line"><span class="keyword">let</span> mapleader=<span class="string">" "</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;leader&gt;</span><span class="keyword">j</span> :%!jq .<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;C-H&gt;</span> <span class="symbol">&lt;C-W&gt;</span><span class="symbol">&lt;C-H&gt;</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;C-L&gt;</span> <span class="symbol">&lt;C-W&gt;</span><span class="symbol">&lt;C-L&gt;</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;C-J&gt;</span> <span class="symbol">&lt;C-W&gt;</span><span class="symbol">&lt;C-J&gt;</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;C-K&gt;</span> <span class="symbol">&lt;C-W&gt;</span><span class="symbol">&lt;C-K&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" 括号自动补全</span></span><br><span class="line"><span class="keyword">inoremap</span> ( ()<span class="symbol">&lt;ESC&gt;</span>i</span><br><span class="line"><span class="keyword">inoremap</span> [ []<span class="symbol">&lt;ESC&gt;</span>i</span><br><span class="line"><span class="keyword">inoremap</span> &#123; &#123;&#125;<span class="symbol">&lt;ESC&gt;</span>i</span><br><span class="line"><span class="comment">" inoremap &lt; &lt;&gt;&lt;ESC&gt;i</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" 插件管理</span></span><br><span class="line"><span class="comment">" NERDTree</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;leader&gt;</span>n :NERDTreeToggle<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">autocmd</span> bufenter * <span class="keyword">if</span> (<span class="built_in">winnr</span>(<span class="string">"$"</span>) == <span class="number">1</span> &amp;&amp; <span class="built_in">exists</span>(<span class="string">"b:NERDTree"</span>) &amp;&amp; <span class="variable">b:NERDTree</span>.isTabTree()) | q | <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeDirArrowExpandable</span>=<span class="string">'📁'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeDirArrowCollapsible</span>=<span class="string">'📂'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeShowBookmarks</span>=<span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeShowLineNumbers</span>=<span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeWinPos</span>=<span class="string">'left'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeWinSize</span>=<span class="number">31</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeMinimalUI</span>=<span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeMinimalMenu</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" vim-flake8</span></span><br><span class="line"><span class="keyword">autocmd</span> BufWritePost *.<span class="keyword">py</span> <span class="keyword">call</span> flake8#Flake8()</span><br><span class="line"><span class="keyword">autocmd</span> FileType <span class="keyword">python</span> <span class="keyword">map</span> <span class="symbol">&lt;buffer&gt;</span> <span class="symbol">&lt;leader&gt;</span><span class="keyword">l</span> :<span class="keyword">call</span> flake8#Flake8()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:flake8_show_quickfix</span>=<span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:flake8_show_in_gutter</span>=<span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:flake8_error_marker</span>=<span class="string">"E&gt;"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:flake8_warning_marker</span>=<span class="string">"W&gt;"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:flake8_pyflake_marker</span>=<span class="string">"F&gt;"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:flake8_complexity_marker</span>=<span class="string">"C&gt;"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:flake8_naming_marker</span>=<span class="string">"N&gt;"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:flake8_quickfix_location</span>=<span class="string">"belowright"</span></span><br><span class="line"><span class="keyword">highlight</span> link Flake8_Error      Error</span><br><span class="line"><span class="keyword">highlight</span> link Flake8_Warning    WarningMsg</span><br><span class="line"><span class="keyword">highlight</span> link Flake8_Complexity WarningMsg</span><br><span class="line"><span class="keyword">highlight</span> link Flake8_Naming     WarningMsg</span><br><span class="line"><span class="keyword">highlight</span> link Flake8_PyFlake    WarningMsg</span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;leader&gt;</span>i :<span class="keyword">call</span> flake8#Flake8ShowError()<span class="symbol">&lt;cr&gt;</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;leader&gt;</span><span class="keyword">c</span> :<span class="keyword">call</span> flake8#Flake8UnplaceMarkers()<span class="symbol">&lt;cr&gt;</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;leader&gt;</span>q :<span class="keyword">cclose</span><span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;leader&gt;</span><span class="keyword">o</span> :<span class="keyword">copen</span><span class="symbol">&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" LeaderF</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:Lf_ShortcutF</span>=<span class="string">'&lt;leader&gt;f'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:Lf_ShortcutB</span>=<span class="string">'&lt;leader&gt;b'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:Lf_WindowPosition</span>=<span class="string">"bottom"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:Lf_WindowHeight</span>=<span class="number">0.5</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:Lf_IndexTimeLimit</span>=<span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:Lf_HideHelp</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:Lf_DefaultMode</span>=<span class="string">'Fuzzy'</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;leader&gt;</span>r :Leaderf rg -<span class="keyword">e</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://muyi110.github.io/shanliu.github.io/2020/Mac%E4%B8%8B%E6%90%AD%E5%BB%BAhexo-github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/shanliu.github.io/images/wukong.png">
      <meta itemprop="name" content="山柳">
      <meta itemprop="description" content="既已无岸，不必回头，唯有向前，踏碎云霄，放肆桀骜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山柳">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/shanliu.github.io/2020/Mac%E4%B8%8B%E6%90%AD%E5%BB%BAhexo-github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">Mac下搭建hexo+github个人博客记录</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-01 10:23:48" itemprop="dateCreated datePublished" datetime="2020-03-01T10:23:48+08:00">2020-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-04 23:51:25" itemprop="dateModified" datetime="2021-01-04T23:51:25+08:00">2021-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/shanliu.github.io/categories/hexo/" itemprop="url" rel="index"><span itemprop="name">hexo</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>此博客记录了在mac系统下基于hexo+github搭建个人博客的过程及一些错误处理</p>
</blockquote>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="安装node-js（默认git已经安装）"><a href="#安装node-js（默认git已经安装）" class="headerlink" title="安装node.js（默认git已经安装）"></a>安装node.js（默认git已经安装）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install node</span><br></pre></td></tr></table></figure>

<h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<h1 id="创建本地博客"><a href="#创建本地博客" class="headerlink" title="创建本地博客"></a>创建本地博客</h1><h2 id="在本地新建一个目录Blog（名字随意），并切换到新建的目录下"><a href="#在本地新建一个目录Blog（名字随意），并切换到新建的目录下" class="headerlink" title="在本地新建一个目录Blog（名字随意），并切换到新建的目录下"></a>在本地新建一个目录Blog（名字随意），并切换到新建的目录下</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir Blog</span><br><span class="line"><span class="built_in">cd</span> Blog</span><br></pre></td></tr></table></figure>

<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>

<p>此时出现错误如下图所示</p>
<p><img src="https://muyi110.github.io/shanliu.github.io/images/Mac%E4%B8%8B%E6%90%AD%E5%BB%BAhexo-github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/hexo_init_error.png" alt="hexo init错误"></p>
<p>根据网上教程，利用如下命令修护</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>

<p>继续报错如下</p>
<p><img src="https://muyi110.github.io/shanliu.github.io/images/Mac%E4%B8%8B%E6%90%AD%E5%BB%BAhexo-github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/xcode-select_error.png" alt="xcode-select_error.png"></p>
<p>继续运行如下命令，弹出的窗点击确定</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf $(xcode-select -<span class="built_in">print</span>-path) (此命令正常什么都不输出)</span><br><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>

<p>搞定~</p>
<h2 id="编译和本地预览"><a href="#编译和本地预览" class="headerlink" title="编译和本地预览"></a>编译和本地预览</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<h2 id="设置next主题（在Blog文件下打开终端）"><a href="#设置next主题（在Blog文件下打开终端）" class="headerlink" title="设置next主题（在Blog文件下打开终端）"></a>设置next主题（在Blog文件下打开终端）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<h2 id="打开站点配置文件-config-yml"><a href="#打开站点配置文件-config-yml" class="headerlink" title="打开站点配置文件_config.yml"></a>打开站点配置文件<code>_config.yml</code></h2><p>修改主题为<code>next</code></p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Mac下搭建hexo-github个人博客记录/modify_config.png" alt="修改全局站点文件主题" style="zoom:60%;" />

<h2 id="打开themes-next-config-yml可以配置next主题"><a href="#打开themes-next-config-yml可以配置next主题" class="headerlink" title="打开themes/next/_config.yml可以配置next主题"></a>打开<code>themes/next/_config.yml</code>可以配置next主题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">106 <span class="comment"># Schemes</span></span><br><span class="line">107 <span class="comment">#scheme: Muse</span></span><br><span class="line">108 <span class="comment">#scheme: Mist</span></span><br><span class="line">109 <span class="comment">#scheme: Pisces</span></span><br><span class="line">110 scheme: Gemini</span><br></pre></td></tr></table></figure>

<h2 id="查看效果"><a href="#查看效果" class="headerlink" title="查看效果"></a>查看效果</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<h1 id="将博客部署到github上"><a href="#将博客部署到github上" class="headerlink" title="将博客部署到github上"></a>将博客部署到github上</h1><p>在<code>github</code>上创建一个新项目<code>new respository</code></p>
<p><img src="https://muyi110.github.io/shanliu.github.io/images/Mac%E4%B8%8B%E6%90%AD%E5%BB%BAhexo-github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/github_new_repository.png" alt="github_new_repository.png"></p>
<p>进入<code>setting</code>进入下拉找到<code>Github pages</code></p>
<p><img src="https://muyi110.github.io/shanliu.github.io/images/Mac%E4%B8%8B%E6%90%AD%E5%BB%BAhexo-github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/github_page.png" alt="github pages配置"></p>
<p>将<code>hexo</code>内容部署到<code>github</code>上，打开站点配置文件<code>_config.yml</code>修改如下</p>
<img src="https://muyi110.github.io/shanliu.github.io/images/Mac下搭建hexo-github个人博客记录/config_github.png" alt="上传github" style="zoom:50%;" />

<h2 id="安装命令"><a href="#安装命令" class="headerlink" title="安装命令"></a>安装命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<h2 id="分发github上"><a href="#分发github上" class="headerlink" title="分发github上"></a>分发<code>github</code>上</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<h1 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h1><p>遇到github显示不出来东西，修改站点配置文件<code>_config.yml</code></p>
<p><img src="https://muyi110.github.io/shanliu.github.io/images/Mac%E4%B8%8B%E6%90%AD%E5%BB%BAhexo-github%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/github_show_error_config.png" alt="github不显示配置修改"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="山柳"
      src="/shanliu.github.io/images/wukong.png">
  <p class="site-author-name" itemprop="name">山柳</p>
  <div class="site-description" itemprop="description">既已无岸，不必回头，唯有向前，踏碎云霄，放肆桀骜</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/shanliu.github.io/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/shanliu.github.io/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">山柳</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/shanliu.github.io/lib/anime.min.js"></script>
  <script src="/shanliu.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/shanliu.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/shanliu.github.io/js/utils.js"></script>

<script src="/shanliu.github.io/js/motion.js"></script>


<script src="/shanliu.github.io/js/schemes/pisces.js"></script>


<script src="/shanliu.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
